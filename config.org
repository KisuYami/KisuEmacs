#+title: KisuEmacs
[[./img/kisuemacs.png]]

* Visual
Themes, modeline, syntax hightlight and more
** GUI
Remove everything that reminds me of a GUI
#+BEGIN_SRC emacs-lisp
  (tool-bar-mode -1)
  (menu-bar-mode -1)
  (scroll-bar-mode -1)

  ;; Fullscreen at startup
  (add-to-list 'default-frame-alist '(fullscreen . maximized))
#+END_SRC
** Theme
A confy theme
#+BEGIN_SRC emacs-lisp
  (use-package doom-themes
    :ensure t
    :config
    (load-theme 'doom-one t)
    (setq doom-themes-enable-bold t	  ; if nil, bold is universally disabled
	  doom-themes-enable-italic t) ; if nil, italics is universally disabled
    (doom-themes-org-config))
#+END_SRC
** Cursor
Highlight the cursor, because i'm blind, i guess
#+BEGIN_SRC emacs-lisp
  (global-hl-line-mode 1)
#+END_SRC
** Scroll
Scroll before cursor hits the end
#+BEGIN_SRC emacs-lisp
  (setq scroll-margin 3
	scroll-conservatively 9999
	scroll-step 1)
#+END_SRC
** Modeline
All modeline sucks, at last this looks good
#+BEGIN_SRC emacs-lisp
  (use-package doom-modeline
    :ensure t
    :init
    :hook (after-init . doom-modeline-mode))
#+END_SRC
** Line Number
Show relative line numbers
#+BEGIN_SRC emacs-lisp
  (defun rcs/line-numbers ()
    "Enable and define config for line numbers."
    (interactive)
    (progn
      (require 'display-line-numbers)
      (global-display-line-numbers-mode 1)
      (display-line-numbers-update-width)
      (setq display-line-numbers-type 'relative)))

  (add-hook 'emacs-startup-hook 'rcs/line-numbers)
#+END_SRC
* Editor
** Lisp
Usefull functions that are plain simple to understand
*** Split Windows
#+BEGIN_SRC emacs-lisp
  (defun split-and-fallow-h ()
    (interactive)
    (split-window-below)
    (balance-windows)
    (other-window 1))

  (defun split-and-fallow-v ()
    (interactive)
    (split-window-right)
    (balance-windows)
    (other-window 1))
#+END_SRC
*** Kill Buffers
#+BEGIN_SRC emacs-lisp
  (defun kill-current-buffer ()
    (interactive)
    (kill-buffer (current-buffer)))

  (defun kill-all-buffers ()
    (interactive)
    (mapc 'kill-buffer (buffer-list)))
#+END_SRC
*** Indent Buffer
#+BEGIN_SRC emacs-lisp
  (defun indent-buffer ()
    "Indent an entire buffer using the default intenting scheme."
    (interactive)
    (save-excursion
      (delete-trailing-whitespace)
      (indent-region (point-min) (point-max))
      (tabify (point-min) (point-max)))
    )
#+END_SRC
*** Create Tags
#+BEGIN_SRC emacs-lisp
  (defun create-tags (dir-name)
    "Create tags file."
    (interactive "DDirectory: ")
    (eshell-command
     (format "find %s -type f -name \"*.[ch]\" | etags -" dir-name)))
#+END_SRC
** Pairs
#+BEGIN_SRC emacs-lisp
  (setq electric-pair-pairs '((?\( . ?\))
			      (?\[ . ?\])
			      (?\{ . ?\})
			      (?\" . ?\")
			      (?\' . ?\')))

  (electric-pair-mode 1)
#+END_SRC
** Commands
#+BEGIN_SRC emacs-lisp
  (defalias 'yes-or-no-p 'y-or-n-p)
  (setq ring-bell-function 'ignore)

  ;; Instead of the default M-x
  (use-package smex
    :ensure t
    :init (smex-initialize))

  ;; Show options for commands
  (use-package which-key
    :ensure t
    :init
    (which-key-mode))

  ;; Edit previlegied files
  (use-package sudo-edit
    :ensure t)
#+END_SRC
** Keyboard
*** Evil
Am I evil? Yes, I am!
#+BEGIN_SRC emacs-lisp
  ;; Fix tab on terminal
  (setq evil-want-C-i-jump nil)

  (use-package evil
    :ensure t
    :init (evil-mode 1))

  (setq evil-emacs-state-modes nil)
  (setq evil-insert-state-modes nil)
  (setq evil-motion-state-modes nil)
  (setq evil-move-cursor-back nil)

  (eval-after-load 'evil
    '(progn
       (evil-make-overriding-map help-mode-map 'normal)
       (evil-make-overriding-map calendar-mode-map 'normal)

       (add-hook 'calendar-mode-hook 'evil-normalize-keymaps)
       (add-hook 'help-mode-hook 'evil-normalize-keymaps)))

  (eval-after-load 'magit
    '(evil-set-initial-state 'magit-popup-mode 'emacs))
#+END_SRC
*** Keymaps
Keybinds that shold be used trough all the modes.
The default leader key is =space= for all the keybinds trough my config
**** Emacs Removing all the default emacs keybinds #+BEGIN_SRC emacs-lisp ;; Unbind Everything (dolist (key '("\C-a" "\C-b" "\C-c" "\C-d" "\C-e" "\C-f" "\C-g" "\C-h" "\C-k" "\C-l" "\C-n" "\C-o" "\C-p" "\C-q" "\C-t" "\C-u" "\C-v" "\C-x" "\C-z" "\e")) (global-unset-key key)) #+END_SRC
**** KEmacs
The master set of keybinds
#+BEGIN_SRC emacs-lisp
  (cua-mode 1)

  (use-package general
    :ensure t)

  (defconst rcs/key-leader "SPC")

  (global-set-key (kbd "M-x") 'smex)
  (evil-define-key nil evil-normal-state-map ";" 'evil-ex)

  (general-define-key
   :states '(normal emacs)
   :prefix rcs/key-leader
   :non-normal-prefix "C-SPC"

   ;; Config
   "cr" '(lambda () (interactive) (org-babel-load-file (expand-file-name "config.org" user-emacs-directory)))
   "ce" '(lambda () (interactive) (find-file (expand-file-name "config.org" user-emacs-directory)))
   "cf" 'indent-buffer

   ;; Files
   "su" 'sudo-edit
   "f"	'ido-find-file
   "F"	'dired

   ;; Buffers
   "k"	'kill-current-buffer
   "b"	'ido-switch-buffer
   "xk" 'kill-all-buffers
   "xb" 'ibuffer

   ;; Windows
   "wo" 'switch-window

   "wv" 'split-and-fallow-v
   "wh" 'split-and-fallow-h

   "wk" 'delete-window
   "wd" 'delete-other-windows

   ;; Help
   "hk" 'helpful-key
   "hf" 'helpful-function
   "hx" 'describe-mode
   "ht" 'help-with-tutorial
   "hi" 'info
   "hy" 'yas-describe-tables
   "hm" 'x86-lookup

   ;; Magit
   "gg" 'magit
   )
#+END_SRC
** Navigation
*** Copy/Paste
#+BEGIN_SRC emacs-lisp
  ;; after copy Ctrl+c in Linux X11, you can paste by `yank' in emacs
  (setq x-select-enable-clipboard t)

  ;; after mouse selection in X11, you can paste by `yank' in emacs
  (setq x-select-enable-primary t)
#+END_SRC
*** I-DO
#+BEGIN_SRC emacs-lisp
  (setq ido-enable-flex-matching nil)
  (setq ido-create-new-buffer 'always)
  (setq ido-everywhere t)
  (ido-mode 1)

  (use-package ido-vertical-mode
    :ensure t
    :init
    (ido-vertical-mode 1))

  (setq ido-vertical-define-keys 'C-n-and-C-p-only)
#+END_SRC
*** Swith Window
#+BEGIN_SRC emacs-lisp
  (use-package switch-window
    :ensure t
    :bind ([remap other-window] . switch-window)
    :config
    (setq switch-window-input-style 'minibuffer)
    (setq switch-window-increase 4)
    (setq switch-window-threshold 2))
#+END_SRC
*** Hungry Delete
#+BEGIN_SRC emacs-lisp
  (use-package hungry-delete
    :ensure t
    :bind (("<backspace>" . hungry-delete-backward)
	   ("<delete>" . hungry-delete-forward))
    :config (global-hungry-delete-mode))
#+END_SRC
** Startup Page
Dash as startup page
*** Start Page
#+BEGIN_SRC emacs-lisp
  (use-package projectile
    :ensure t
    :config
    (projectile-mode +1)
    (setq projectile-project-search-path '("~/Dev/Software"))
    (setq projectile-enable-caching t))

  (use-package page-break-lines
    :ensure t)

  (use-package dashboard
    :ensure t
    :config
    (dashboard-setup-startup-hook)
    (setq dashboard-startup-banner "~/.emacs.d/img/dashLogo.png")
    (setq dashboard-banner-logo-title "Welcome to the dark side")
    (setq dashboard-center-content t)
    (setq dashboard-show-shortcuts nil)
    (setq dashboard-items '((agenda . 5)
			    (recents  . 5)
			    (projects . 15))))
#+END_SRC
*** Keybinds
#+BEGIN_SRC emacs-lisp
  (general-define-key
   :states '(normal emacs)
   :keymaps 'dashboard-mode-map
   :prefix rcs/key-leader
   :non-normal-prefix "C-SPC"

   ;; Agenda
   "Aa" 'org-agenda
   "Am" 'calendar
   "Ad" 'diary
   )
#+END_SRC
** Encoding/text
#+BEGIN_SRC emacs-lisp
  ;; UTF-8
  (setq locale-coding-system 'utf-8)
  (set-terminal-coding-system 'utf-8)
  (set-keyboard-coding-system 'utf-8)
  (set-selection-coding-system 'utf-8)
  (prefer-coding-system 'utf-8)

  ;; Set font
  (add-to-list 'default-frame-alist '(font . "Hack-11" ))
#+END_SRC
** Backup/Autosave
#+BEGIN_SRC emacs-lisp
  (if (not (file-exists-p "~/.local/share/emacs/backups/"))
      (make-directory "~/.local/share/emacs/backups/" t))

  (setq backup-directory-alist `(("." . "~/.local/share/emacs/backups/")))
  (setq make-backup-files t		; backup of a file the first time it is saved.
	backup-by-copying t		; don't clobber symlinks
	version-control t			; version numbers for backup files
	delete-old-versions t		; delete excess backup files silently
	delete-by-moving-to-trash t
	kept-old-versions 6		; oldest versions to keep when a new numbered backup is made (default: 2)
	kept-new-versions 9		; newest versions to keep when a new numbered backup is made (default: 2)
	auto-save-default t		; auto-save every buffer that visits a file
	auto-save-timeout 20		; number of seconds idle time before auto-save (default: 30)
	auto-save-interval 200		; number of keystrokes between auto-saves (default: 300)
	)

  ;; Auto-save
  (if (not (file-exists-p "~/.local/share/emacs/autosaves/"))
      (make-directory "~/.local/share/emacs/autosaves/" t))
  (setq auto-save-file-name-transforms
	`((".*" "~/.local/share/emacs/autosaves/" t)))
#+END_SRC
* Programming
** Info
*** Git
#+BEGIN_SRC emacs-lisp
  (use-package magit
    :ensure t)

  (use-package evil-magit
    :ensure t)

  (use-package git-gutter+
    :ensure t
    :init (global-git-gutter+-mode +1))

  (use-package git-gutter-fringe+
    :ensure t
    :config
    (setq-default fringes-outside-margins t)
    (setq-default left-fringe-width	 3)
    (setq-default right-fringe-width 0)

    (fringe-helper-define 'git-gutter-fr+-added nil
      "XXXXXXXX"
      "XXXXXXXX"
      "XXXXXXXX"
      "XXXXXXXX"
      "XXXXXXXX"
      "XXXXXXXX"
      "XXXXXXXX"
      "XXXXXXXX"
      "XXXXXXXX"
      "XXXXXXXX"
      "XXXXXXXX"
      "XXXXXXXX"
      "XXXXXXXX"
      "XXXXXXXX"
      "XXXXXXXX"
      "XXXXXXXX"
      "XXXXXXXX")

    (fringe-helper-define 'git-gutter-fr+-deleted nil
      "XXXXXXXX"
      "XXXXXXXX"
      "XXXXXXXX"
      "XXXXXXXX"
      "XXXXXXXX"
      "XXXXXXXX"
      "XXXXXXXX"
      "XXXXXXXX"
      "XXXXXXXX"
      "XXXXXXXX"
      "XXXXXXXX"
      "XXXXXXXX"
      "XXXXXXXX"
      "XXXXXXXX"
      "XXXXXXXX"
      "XXXXXXXX"
      "XXXXXXXX")

    (fringe-helper-define 'git-gutter-fr+-modified nil
      "XXXXXXXX"
      "XXXXXXXX"
      "XXXXXXXX"
      "XXXXXXXX"
      "XXXXXXXX"
      "XXXXXXXX"
      "XXXXXXXX"
      "XXXXXXXX"
      "XXXXXXXX"
      "XXXXXXXX"
      "XXXXXXXX"
      "XXXXXXXX"
      "XXXXXXXX"
      "XXXXXXXX"
      "XXXXXXXX"
      "XXXXXXXX"
      "XXXXXXXX"))
#+END_SRC
*** Docs
#+BEGIN_SRC emacs-lisp
  (use-package helpful
    :ensure t)

  ;; Fix the keybinds for helpful
  (eval-after-load 'evil
    '(progn
       (evil-make-overriding-map helpful-mode-map 'normal)
       (add-hook 'helpful-mode-hook 'evil-normalize-keymaps)))
#+END_SRC
*** Highlighting
#+BEGIN_SRC emacs-lisp
  (use-package whitespace
    :ensure t
    :config
    (setq whitespace-line-column 81) ;; limit line length
    (setq whitespace-style '(face lines-tail))

    (add-hook 'prog-mode-hook 'whitespace-mode))

  (use-package hl-todo
    :ensure t
    :config
    (global-hl-todo-mode t))

  ;; turn on highlight matching brackets when cursor is on one
  (show-paren-mode 1)
#+END_SRC
** Modes
*** Org
**** Geral
#+BEGIN_SRC emacs-lisp
  (setq org-ellipsis " ")
  (setq org-src-fontify-natively t)
  (setq org-src-tab-acts-natively t)
  (setq org-export-with-smart-quotes t)
  (setq org-src-window-setup 'current-window)
  (add-hook 'org-mode-hook 'org-indent-mode)

  (setq org-todo-keywords
	'((sequence "TODO" "IN-PROGRESS" "WAITING" "DONE")))

  (use-package org-bullets
    :ensure t
    :config
    (add-hook 'org-mode-hook(lambda () (org-bullets-mode))))
#+END_SRC
**** Prettify
#+BEGIN_SRC emacs-lisp
  (defun setup-pragmata-ligatures ()
    (setq prettify-symbols-alist
	  (append prettify-symbols-alist
		  '(("[ ]" . "☐")
		    ("[X]" . "☑")
		    ("[-]" . "❍")
		    ("#+BEGIN_SRC" . "λ")
		    ("#+END_SRC" . "λ")))))

  (defun refresh-pretty ()
    (prettify-symbols-mode -1)
    (prettify-symbols-mode +1))

  ;; Hooks for modes in which to install the Pragmata ligatures
  (mapc (lambda (hook)
	  (add-hook hook (lambda () (setup-pragmata-ligatures) (refresh-pretty))))
	'(text-mode-hook
	  prog-mode-hook))
  (global-prettify-symbols-mode +1)
#+END_SRC
**** Babel
#+BEGIN_SRC emacs-lisp
  (setq org-confirm-babel-evaluate nil)

  (org-babel-do-load-languages
   'org-babel-load-languages
   '((R . t)
     (latex . t)
     (C . t)
     (shell . t)))
#+END_SRC
**** Diary
#+BEGIN_SRC emacs-lisp
  (setq org-agenda-files (quote ("~/Documents/Org/Agenda.org")))

  (setq view-diary-entries-initially t
	mark-diary-entries-in-calendar t
	number-of-diary-entries 7)
  (add-hook 'diary-display-hook 'fancy-diary-display)
  (add-hook 'today-visible-calendar-hook 'calendar-mark-today)
#+END_SRC
**** Exports
#+BEGIN_SRC emacs-lisp
  (use-package ox-twbs
    :ensure t)

  ;; Fix citations
  (setq org-latex-pdf-process
	'("pdflatex -shell-escape -interaction nonstopmode -output-directory %o %f"
	  "pdflatex -shell-escape -interaction nonstopmode -output-directory %o %f"
	  "pdflatex -shell-escape -interaction nonstopmode -output-directory %o %f"))
#+END_SRC
**** Keybinds
#+BEGIN_SRC emacs-lisp
  (general-define-key
   :states '(normal)
   :keymaps 'org-mode-map
   :prefix rcs/key-leader
   :non-normal-prefix "C-SPC"
   "e"	'eval-last-sexp

   "E" 'org-babel-execute-src-block
   "oa" 'org-agenda
   "oe" 'org-export-dispatch
   "op" 'org-latex-export-to-pdf
   "o[" 'org-agenda-file-to-front
   "o]" 'org-remove-file
   "o." 'org-agenda-time-stamp
   "oc."'org-time-stamp
   "od" 'org-deadline
   "os" 'org-schedule
   "'" 'org-edit-special
   )

  (general-define-key
   :states '(normal)
   :keymaps 'emacs-lisp-mode-map
   :prefix rcs/key-leader
   :non-normal-prefix "C-SPC"

   "e"	'eval-last-sexp
   "'" 'org-edit-src-exit
   )
#+END_SRC
**** Snippets
#+BEGIN_SRC emacs-lisp
  (add-to-list 'org-structure-template-alist
	       '("el" "#+BEGIN_SRC emacs-lisp\n?\n#+END_SRC"))
#+END_SRC
*** C
Specific configurations for C programming.
**** Keybinds
#+BEGIN_SRC emacs-lisp
  (general-def
    :states '(normal)
    :keymaps 'c-mode-map
    :prefix rcs/key-leader
    :non-normal-prefix "C-SPC"
    "cc" 'projectile-compile-project
    "ct" 'create-tags
    )

  (general-def
    :states '(normal)
    :keymaps 'c-mode-map
    "<f12>" 'recompile
    )
#+END_SRC
**** Indentation
Tabs are truth
#+BEGIN_SRC emacs-lisp
  (setq c-default-style "linux")
  (setq-default tab-always-indent t)
  (setq-default indent-tabs-mode t)
  (setq-default c-basic-offset 8)
  (setq-default tab-width 8)
#+END_SRC
**** Compilation
Shows if the compilation succeded or failed in the minibuffer
#+BEGIN_SRC emacs-lisp
  (defun brian-compile-finish (buffer outstr)
    (unless (string-match "finished" outstr)
      (switch-to-buffer-other-window buffer))
    t)

  (setq compilation-finish-functions 'brian-compile-finish)

  (require 'cl)

  (defadvice compilation-start
      (around inhibit-display
	      (command &optional mode name-function highlight-regexp))
    (if (not (string-match "^\\(find\\|grep\\)" command))
	(cl-flet ((display-buffer)
		  (set-window-point)
		  (goto-char))
	  (fset 'display-buffer 'ignore)
	  (fset 'goto-char 'ignore)
	  (fset 'set-window-point 'ignore)
	  (save-window-excursion
	    ad-do-it))
      ad-do-it))

  (ad-activate 'compilation-start)
#+END_SRC
** Auto Completion
*** Code
Keep good company
#+BEGIN_SRC emacs-lisp
  (use-package company
    :ensure t
    :config
    (add-hook 'after-init-hook 'global-company-mode)
    (setq company-idle-delay 0)
    (setq company-minimum-prefix-lenght 3)
    :preface
    ;; enable yasnippet everywhere
    (defvar company-mode/enable-yas t
      "Enable yasnippet for all backends.")
    (defun company-mode/backend-with-yas (backend)
      (if (or
	   (not company-mode/enable-yas)
	   (and (listp backend) (member 'company-yasnippet backend)))
	  backend
	(append (if (consp backend) backend (list backend))
		'(:with company-yasnippet)))))

  (with-eval-after-load 'company
    (define-key company-active-map (kbd "M-n") 'nil)
    (define-key company-active-map (kbd "M-p") 'nil)
    (define-key company-active-map (kbd "C-n") 'company-select-next)
    (define-key company-active-map (kbd "C-p") 'company-select-previous)
    (add-hook 'c++-mode-hook 'company-mode)
    (add-hook 'c-mode-hook 'company-mode))

  ;; Backend for C/C++ autocompletion
  (use-package irony
    :ensure t
    :config
    (add-hook 'c++-mode-hook 'irony-mode)
    (add-hook 'c-mode-hook 'irony-mode)
    (add-hook 'irony-mode-hook 'irony-cdb-autosetup-compile-options))

  ;;Integration for company and irony
  (use-package company-irony
    :ensure t
    :config
    (require 'company)
    (add-to-list 'company-backends 'company-irony)
    (add-to-list 'company-backends 'company-c-headers))
#+END_SRC
*** Snippets
#+BEGIN_SRC emacs-lisp
  (use-package yasnippet
    :ensure t
    :init (yas-global-mode t)
    :config
    (use-package yasnippet-snippets
      :ensure t)
    (yas-reload-all))
#+END_SRC
